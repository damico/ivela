var $_={fn:function(){return function(){}},merge:function(){var e={};for(var d=0,a=arguments.length;d<a;d++){var b=arguments[d];if(typeof b!="object"){continue}for(var c in b){var g=b[c],f=e[c];e[c]=(f&&typeof g=="object"&&typeof f=="object")?this.merge(f,g):this.unlink(g)}}return e},unlink:function(c){var b=null;switch(typeof c){case"object":b={};for(var e in c){b[e]=this.unlink(c[e])}break;case"array":b=[];for(var d=0,a=c.length;d<a;d++){b[d]=this.unlink(c[d])}break;default:return c}return b}};var Config={orientation:"left",labelContainer:"label_container",levelsToShow:2,offsetBase:12,Label:{height:30,realHeight:25,width:180,realWidth:160,offsetHeight:30,offsetWidth:30},Node:{strokeStyle:"#ccc",fillStyle:"#ccc",strokeStyleInPath:"#ffe79c",fillStyleInPath:"#ffe79c",mode:"fill",style:"squared"},animationTime:500,fps:25};var Canvas=function(a){if("function"==typeof(HTMLCanvasElement)||"object"==typeof(HTMLCanvasElement)){this.canvasId=a;if((this.canvas=document.getElementById(this.canvasId))&&this.canvas.getContext){this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle=Config.Node.fillStyle||"black";this.ctx.strokeStyle=Config.Node.strokeStyle||"black";this.setPosition();this.translateToCenter()}else{throw"canvas object with id "+a+" not found"}}else{throw"your browser does not support canvas. Try viewing this page with firefox, safari or opera 9.5"}};Canvas.prototype={getContext:function(){return this.ctx},makeNodeStyleSelected:function(a,b){this.ctx[b+"Style"]=(a)?Config.Node[b+"StyleInPath"]:Config.Node[b+"Style"]},makeEdgeStyleSelected:function(a){this.ctx.strokeStyle=(a)?Config.Node.strokeStyleInPath:Config.Node.strokeStyle;this.ctx.lineWidth=(a)?2:1},makeRect:function(c,b,a){if(b=="fill"||b=="stroke"){this.makeNodeStyleSelected(a,b);this.ctx[b+"Rect"](c.x1,c.y1,c.x2,c.y2)}else{throw"parameter not recognized "+b}},setPosition:function(){var a=this.canvas;var b=curtop=0;if(a.offsetParent){b=a.offsetLeft;curtop=a.offsetTop;while(a=a.offsetParent){b+=a.offsetLeft;curtop+=a.offsetTop}}this.position={x:b,y:curtop}},getPosition:function(){return this.position},clear:function(){this.ctx.clearRect(-this.getSize().x/2,-this.getSize().x/2,this.getSize().x,this.getSize().x)},clearRectangle:function(d,b,a,c){this.ctx.clearRect(c,d-2,b-c+2,Math.abs(a-d)+5)},translateToCenter:function(){this.ctx.translate(this.getSize().x/2,this.getSize().y/2)},getSize:function(){return{x:this.canvas.width,y:this.canvas.height}},path:function(a,b){this.ctx.beginPath();b(this.ctx);this.ctx[a]();this.ctx.closePath()}};var Complex=function(){if(arguments.length>1){this.x=arguments[0];this.y=arguments[1]}else{this.x=null;this.y=null}};Complex.prototype={clone:function(){return new Complex(this.x,this.y)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(a){return new Complex(this.x+a.x,this.y+a.y)},prod:function(a){return new Complex(this.x*a.x-this.y*a.y,this.y*a.x+this.x*a.y)},conjugate:function(){return new Complex(this.x,-this.y)},scale:function(a){return new Complex(this.x*a,this.y*a)},$add:function(a){this.x+=a.x;this.y+=a.y;return this},$prod:function(c){var a=this.x,b=this.y;this.x=a*c.x-b*c.y;this.y=b*c.x+a*c.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(a){this.x*=a;this.y*=a;return this},$div:function(d){var a=this.x,c=this.y;var b=d.squaredNorm();this.x=a*d.x+c*d.y;this.y=c*d.x-a*d.y;return this.$scale(1/b)}};var Tree=function(a){(function(c,d){Tree.Node(c,d);for(var b=0;b<c.children.length;b++){arguments.callee(c.children[b],c)}})(a,null)};Tree.Node=function(a,b){a.selected=false;a.drawn=false;a.exist=false;a._parent=b;a.pos=new Complex(0,0);a.startPos=new Complex(0,0);a.endPos=new Complex(0,0);a.startAlpha=1;a.endAlpha=1;a.alpha=1};Tree.Util={set:function(a,c,d){if(typeof c=="object"){for(var e in c){a[e]=c[e]}}else{if(typeof c=="array"){for(var b=0;b<c.length;b++){a[c[b]]=d}}else{a[c]=d}}},addSubtree:function(a,d,c){var b=this.getSubtree(a,d);Tree(c);if(d==c.id){b.children=b.children.concat(c.children);Tree.Children.each(b,function(e){e._parent=b})}else{b.children.push(c);c._parent=b}return c},removeSubtree:function(a,f,b){var c=this.getSubtree(a,f);var d=c._parent;if(!b){delete c.children;c.children=[]}else{var e=new Array();Tree.Children.each(d,function(g){if(f!=g.id){e.push(g)}});d.children=e}},each:function(a,b){this.eachLevel(a,0,Number.MAX_VALUE,b)},eachLevel:function(a,b,c,f){if(b<=c){f(a,b);var e=a.children;for(var d=0;d<e.length;d++){this.eachLevel(e[d],b+1,c,f)}}},atLevel:function(a,c,b){this.eachLevel(a,0,c,function(e,d){if(d==c){b(e)}})},getLevel:function(a){var b=function(c,d){if(c._parent==null){return d}else{return b(c._parent,d+1)}};return b(a,0)},getRoot:function(a){if(a._parent==null){return a}return this.getRoot(a._parent)},getLeaves:function(a){var b=new Array();this.eachLevel(a,0,Config.levelsToShow,function(d,c){if(d.drawn&&!Tree.Children.children(d,"exist")){b.push(d);d._level=Config.levelsToShow-c}});return b},getSubtree:function(a,c){var b=null;this.each(a,function(d){if(d.id==c){b=d}});return b}};Tree.Children={each:function(a,d){for(var b=0,c=a.children;b<c.length;b++){d(c[b])}},children:function(a,d){for(var b=0,c=a.children;b<c.length;b++){if(!d||c[b][d]){return true}}return false},getChildren:function(a,e){for(var c=0,b=new Array(),d=a.children;c<d.length;c++){if(!e||d[c][e]){b.push(d[c])}}return b},getLength:function(a,e){if(!e){return a.children.length}for(var c=0,b=0,d=a.children;c<d.length;c++){if(d[c][e]){b++}}return b}};Tree.Group={requestNodes:function(e,d){var c=0,a=e.length,g={};var b=function(){d.onComplete()};if(a==0){b()}for(var f=0;f<a;f++){g[e[f].id]=e[f];d.request(e[f].id,e[f]._level,{onComplete:function(l,k){if(k&&k.children){Tree(k);for(var h=0,i=k.children;h<i.length;h++){i[h]._parent=g[l]}g[l].children=k.children}if(++c==a){b()}}})}},hide:function(c,d,b){c=this.getNodesWithChildren(c);var a=d.getContext();for(var e=0;e<c.length;e++){Tree.Children.each(c[e],function(g){Tree.Plot.hideLabels(g,true)})}a.save();var f={compute:function(k){for(var g=0;g<c.length;g++){a.save();var h=c[g];var j=Tree.Geometry.getBoundingBox(h);d.clearRectangle(j.top,j.right,j.bottom,j.left);if(k==1){k=0.99}Tree.Plot.plot(h,d,b,1-k);a.restore()}},complete:function(){a.restore();for(var g=0;g<c.length;g++){if(!b||!b.request){if(Tree.Children.children(c[g],"exist")){Tree.Util.each(c[g],function(h){Tree.Util.set(h,{drawn:false,exist:false})});Tree.Util.set(c[g],{drawn:true,exist:true})}}else{delete c[g].children;c[g].children=[]}}b.onComplete()}};Animation.controller=f;Animation.start()},show:function(c,d,b){c=this.getNodesWithChildren(c),newNodes=new Array();var a=d.getContext();for(var e=0;e<c.length;e++){if(!Tree.Children.children(c[e],"drawn")){newNodes.push(c[e]);Tree.Util.eachLevel(c[e],0,Config.levelsToShow,function(g){if(g.exist){g.drawn=true}})}}c=newNodes;a.save();var f={compute:function(k){for(var g=0;g<c.length;g++){a.save();var h=c[g];var j=Tree.Geometry.getBoundingBox(h);d.clearRectangle(j.top,j.right,j.bottom,j.left);Tree.Plot.plot(h,d,b,k);a.restore()}},complete:function(){a.restore();for(var g=0;g<c.length;g++){var h=c[g];var j=Tree.Geometry.getBoundingBox(h);d.clearRectangle(j.top,j.right,j.bottom,j.left);Tree.Plot.plot(h,d,b)}b.onComplete()}};Animation.controller=f;Animation.start()},getNodesWithChildren:function(b){var a=new Array();for(var c=0;c<b.length;c++){if(Tree.Children.children(b[c],"exist")){a.push(b[c])}}return a}};Tree.Plot={plot:function(a,d,c,f){if(f>=0){a.drawn=false;var b=d.getContext();var e=Tree.Geometry.getScaledTreePosition(a,f);b.translate(e.x,e.y);b.scale(f,f)}this.plotTree(a,d,!f,c);if(f>=0){a.drawn=true}},plotTree:function(a,e,d,c){var g=this,b=e.getContext();var f=Tree.Geometry.getEdge(a.pos,"begin");Tree.Children.each(a,function(j){if(j.exist){var h=Tree.Geometry.getEdge(j.pos,"end");if(j.drawn){var i={nodeFrom:a,nodeTo:j};c.onBeforePlotLine(i);b.globalAlpha=Math.min(a.alpha,j.alpha);g.plotEdge(f,h,e,a.selected&&j.selected);c.onAfterPlotLine(i)}g.plotTree(j,e,d,c)}});if(a.drawn&&a.exist){b.globalAlpha=a.alpha;this.plotNode(a,e);if(d&&b.globalAlpha>=0.95){Tree.Label.plotOn(a,e)}else{Tree.Label.hide(a)}}},plotNode:function(b,a){if(Config.Node.style=="squared"){this.plotNodeSquared(b,a)}else{throw"parameter not recognized "+Config.Node.style}},plotNodeSquared:function(c,a){var e=c.pos,b=c.selected;var d={x1:e.x,y1:e.y-Config.Label.height+(Config.Label.height-Config.Label.realHeight)/2,x2:Config.Label.realWidth,y2:Config.Label.realHeight};a.makeRect(d,Config.Node.mode,b)},plotEdge:function(d,a,b,c){b.makeEdgeStyleSelected(c);b.path("stroke",function(e){e.moveTo(d.x,d.y);e.lineTo(a.x,a.y)})},hideLabels:function(c,b){var a=Tree.Label;Tree.Util.each(c,function(d){if(b){a.hide(d)}else{a.show(d)}})},animate:function(a,e,b){var g=this;var c=function(j,i,h){return(i.$add(j.scale(-1))).$scale(h).$add(j)};var d=function(h,k){var j=h.startPos.clone();var i=h.endPos.clone();h.pos=c(j,i,k)};var f={compute:function(h){e.clear();Tree.Util.each(a,function(i){d(i,h)});g.plot(a,e,b)},complete:function(){Tree.Util.each(a,function(h){h.startPos=h.pos});g.plot(a,e,b);b.onComplete()}};Animation.controller=f;Animation.start()},fade:function(a,e,b){var g=this;var c=function(j,i,h){return j+(i-j)*h};var d=function(h,k){var j=h.startAlpha;var i=h.endAlpha;h.alpha=c(j,i,k)};var f={compute:function(h){e.clear();Tree.Util.each(a,function(i){d(i,h)});g.plot(a,e,b)},complete:function(){Tree.Util.each(a,function(h){h.startAlpha=h.alpha});g.plot(a,e,b);b.onComplete()}};Animation.controller=f;Animation.start()}};Tree.Label={nodeHash:{},container:false,st:null,chk:function(a){if(!(a.id in this.nodeHash)){this.init(a)}return this.nodeHash[a.id]},init:function(c){var b=this.st;if(!(c.id in this.nodeHash)){if(!this.container){this.container=document.getElementById(Config.labelContainer)}var a=document.createElement("a");a.id=c.id;a.href="#";a.onclick=function(){b.onClick(c.id);return false};a.innerHTML=c.name;this.container.appendChild(a);b.controller.onCreateLabel(a,c);this.nodeHash[c.id]=a}this.setClass(c,"node hidden");this.setDimensions(c)},plotOn:function(b,a){var c=b.pos;if(this.fitsInCanvas(c,a)){this.setDivProperties(b,"node",a)}else{this.hide(b)}},fitsInCanvas:function(c,a){var b=a.getSize();return !(Math.abs(c.x+Config.Label.width/2)>=b.x/2||Math.abs(c.y)>=b.y/2)},setDivProperties:function(e,c,d){var b=d.getSize(),a=d.getPosition(),h=e.pos;var f={x:Math.round(h.x+a.x+b.x/2),y:Math.round(h.y+a.y+b.y/2-Config.Label.height)};var g=this.chk(e);g.style.top=f.y+"px";g.style.left=f.x+"px";this.removeClass(e,"hidden");this.setDimensions(e)},addClass:function(c,a){var b=this.chk(c);if(!this.hasClass(c,a)){var d=b.className.split(" ");d.push(a);b.className=d.join(" ")}},setDimensions:function(b){var a=this.chk(b);a.style.width=Config.Label.realWidth+"px";a.style.height=Config.Label.realHeight+"px";this.st.controller.onPlaceLabel(a,b)},removeClass:function(e,a){var d=this.chk(e);var f=d.className.split(" ");var b=false;for(var c=0;c<f.length&&!b;c++){if(f[c]==a){f.splice(c,1);b=true}}d.className=f.join(" ")},hasClass:function(c,a){var d=this.chk(c).className.split(" ");for(var b=0;b<d.length;b++){if(a==d[b]){return true}}return false},setClass:function(b,a){this.chk(b).className=a},hide:function(a){this.addClass(a,"hidden")},show:function(a){this.removeClass(a,"hidden")}};Tree.Geometry={left:function(){return Config.orientation=="left"},switchOrientation:function(){Config.orientation=this.left()?"top":"left"},getSize:function(c){var a=Config.Label.width,b=Config.Label.height;if(!c){return(this.left())?a:b}else{return(this.left())?b:a}},getOffsetSize:function(){return(!this.left())?Config.Label.offsetHeight:Config.Label.offsetWidth},translate:function(a,c,b){Tree.Util.each(a,function(d){d[b].$add(c)})},getBoundingBox:function(a){var c=Config.Label,d=a.pos;var b={top:d.y,bottom:d.y,right:d.x,left:d.x};this.calculateCorners(a,b);if(this.left()){return{left:b.left+c.realWidth,bottom:b.bottom,top:b.top-c.height,right:b.right+c.width}}else{return{left:b.left,bottom:b.bottom,top:b.top,right:b.right+c.width}}},calculateCorners:function(a,b){var e=a.pos;if(a.exist){if(b.top>e.y){b.top=e.y}if(b.bottom<e.y){b.bottom=e.y}if(b.right<e.x){b.right=e.x}if(b.left>e.x){b.left=e.x}for(var c=0,d=a.children;c<d.length;c++){this.calculateCorners(d[c],b)}}},getBaseSize:function(a,b,d){var c=this.getSize(true);if(b){return(d=="available")?c:Tree.Children.getLength(a,"exist")*c+Config.offsetBase}return this.getTreeBaseSize(a,"expanded")},getTreeBaseSize:function(a,g,h){var e=this.getSize(true),c=function(i,k,j){return k==0||(j=="expanded")?Tree.Children.getLength(i,"exist")==0:i.children.length==0};h=(arguments.length==3)?h:Number.MAX_VALUE;if(c(a,h,g)){return e}for(var d=0,f=a.children,b=0;d<f.length;d++){b+=this.getTreeBaseSize(f[d],g,h-1)}return b+Config.offsetBase},getEdge:function(d,a){var c=Config.Label,b=this.left();if(a=="begin"){return b?d.add(new Complex(c.realWidth,-c.height/2)):d.add(new Complex(c.realWidth/2,(c.realHeight-c.height)/2))}else{if(a=="end"){return b?d.add(new Complex(0,-c.height/2)):d.add(new Complex(c.realWidth/2,-c.realHeight))}}},getScaledTreePosition:function(b,d){var c=Config.Label.width,a=Config.Label.height;if(this.left()){return b.pos.add(new Complex(c,-a/2)).$scale(1-d)}return b.pos.add(new Complex(c/2,0)).$scale(1-d)},treeFitsInCanvas:function(a,b,e){var c=(this.left())?b.getSize().y:b.getSize().x;var d=this.getTreeBaseSize(a,"exist",e);return(d<c)},getFirstPos:function(d,a){var c=this.getSize()+this.getOffsetSize(),b=-a/2+Config.offsetBase/2;return this.left()?new Complex(d.x+c,d.y+b):new Complex(d.x+b,d.y+c)},nextPosition:function(b,a){return this.left()?new Complex(b.x,b.y+a):new Complex(b.x+a,b.y)},setRightLevelToShow:function(a,b){var c=this.getRightLevelToShow(a,b);Tree.Util.eachLevel(a,0,Config.levelsToShow,function(e,d){if(d>c){e.drawn=false;e.exist=false;Tree.Label.hide(e)}else{e.exist=true}});a.drawn=true},getRightLevelToShow:function(a,b){var c=Config.levelsToShow;while(!this.treeFitsInCanvas(a,b,c)&&c>1){c--}return c}};var ST=function(c,a){var b={onBeforeCompute:$_.fn(),onAfterCompute:$_.fn(),onCreateLabel:$_.fn(),onPlaceLabel:$_.fn(),onCreateElement:$_.fn(),onComplete:$_.fn(),onBeforePlotLine:$_.fn(),onAfterPlotLine:$_.fn(),request:false};this.controller=$_.merge(b,a);this.canvas=c;this.tree=null;this.clickedNode=null;Tree.Label.st=this;Animation.fps=Config.fps;Animation.duration=Config.animationTime};ST.prototype={loadFromJSON:function(a){this.tree=a;Tree(a)},compute:function(){Tree.Util.set(this.tree,{drawn:true,exist:true,selected:true});this.calculatePositions(this.tree,new Complex(0,0),"startPos")},calculatePositions:function(p,f,m,g){var c=Tree.Geometry,n=Tree.Children,g=(arguments.length==3)?true:g;if(this.clickedNode&&(p.id==this.clickedNode.id)&&g){g=false}p[m]=f;var a=Tree.Children.getChildren(p,"exist");if(a.length>0){var j=c.getBaseSize(p,g);var l=c.getBaseSize(a[0],g,"available");var d=(a.length==1)?Config.offsetBase:j-l;var b=a[0][m]=c.getFirstPos(f,d);this.calculatePositions(a[0],b,m,g);for(var h=1;h<a.length;h++){var k=!n.children(a[h],"exist")||!n.children(a[h-1],"exist");var o=c.getBaseSize(a[h],g,"available");var e=k?c.getSize(true):(l+o)/2;b=c.nextPosition(b,e);l=o;this.calculatePositions(a[h],b,m,g)}}},plot:function(){Tree.Plot.plot(this.tree,this.canvas,this.controller)},switchPosition:function(e){var b=Tree.Geometry,c=Tree.Plot,a=this.tree,d=this;if(!c.busy){c.busy=true;this.contract({onComplete:function(){b.switchOrientation();d.calculatePositions(a,new Complex(0,0),"endPos");c.busy=false;d.onClick(d.clickedNode.id,e)}},true)}},requestNodes:function(b,c){var a=$_.merge(this.controller,c);if(a.request){Tree.Group.requestNodes(Tree.Util.getLeaves(b),a)}else{a.onComplete()}},contract:function(f,h){var b=Tree.Geometry,g=Tree.Util,d=Tree.Group;var a=this.clickedNode;var e=function(i,k){var m=g.getLevel(i),j=g.getRoot(i),l=new Array();g.eachLevel(j,0,m,function(o,n){if(o.exist&&!o.selected){l.push(o)}});m=b.getRightLevelToShow(i,k);g.atLevel(i,m,function(o,n){if(o.exist){l.push(o)}});return l};if(h){b.switchOrientation()}var c=e(a,this.canvas);if(h){b.switchOrientation()}d.hide(c,this.canvas,$_.merge(this.controller,f))},move:function(a,b){this.calculatePositions(this.tree,new Complex(0,0),"endPos");Tree.Geometry.translate(this.tree,a.endPos.scale(-1),"endPos");Tree.Plot.animate(this.tree,this.canvas,$_.merge(this.controller,b))},expand:function(b,c){var a=new Array();Tree.Util.eachLevel(b,0,Config.levelsToShow,function(e,d){if(!Tree.Children.children(e,"drawn")){a.push(e)}});Tree.Group.show(a,this.canvas,$_.merge(this.controller,c))},selectPath:function(b,a){(function(c,d){if(c==null){return arguments.callee}c.selected=d;return arguments.callee(c._parent,d)})(a,false)(b,true)},addSubtree:function(g,c,f,d){var e=Tree.Util,b=this,a=e.addSubtree(this.tree,g,c);if(f=="replot"){this.onClick(this.clickedNode.id,$_.merge({onMoveComplete:function(){e.each(a,function(h){h.drawn=h.exist})},onExpandComplete:function(){b.canvas.clear();b.plot()}},d))}else{if(f=="animate"){this.onClick(this.clickedNode.id,{onMoveComplete:function(){e.each(a,function(h){h.drawn=h.exist})},onExpandComplete:function(){e.each(a,function(h){e.set(h,{drawn:h.exist,startAlpha:h.exist?0:1,endAlpha:1,alpha:h.exist?0:1,})});Tree.Plot.fade(b.tree,b.canvas,$_.merge(b.controller,d))}})}}},removeSubtree:function(g,b,f,d){var e=Tree.Util,c=this;if(f=="replot"){this.onClick(this.clickedNode.id,$_.merge({onContractComplete:function(){Tree.Plot.hideLabels(e.getSubtree(c.tree,g),true);e.removeSubtree(c.tree,g,b)}},d))}else{if(f=="animate"){var a=e.getSubtree(this.tree,g);e.each(a,function(h){e.set(h,{drawn:h.exist,startAlpha:1,endAlpha:0,alpha:1,})});if(!b){e.set(a,{drawn:elem.exist,startAlpha:1,endAlpha:1,alpha:1,})}Tree.Plot.fade(this.tree,this.canvas,$_.merge(c.controller,{onComplete:function(){e.removeSubtree(c.tree,g,b);c.onClick(c.clickedNode.id,d)}}))}}},onClick:function(c,f){var d=this.canvas,h=this,j=Tree.Plot,i=Tree.Util,a=Tree.Geometry;var g={onRequestNodesComplete:$_.fn(),onContractComplete:$_.fn(),onMoveComplete:$_.fn(),onExpandComplete:$_.fn()};var b=$_.merge(this.controller,g,f);if(!j.busy){j.busy=true;var e=i.getSubtree(this.tree,c);this.selectPath(e,this.clickedNode);this.clickedNode=e;b.onBeforeCompute(e);this.requestNodes(e,{onComplete:function(){b.onRequestNodesComplete();h.contract({onComplete:function(){a.setRightLevelToShow(e,d);b.onContractComplete();h.move(e,{onComplete:function(){b.onMoveComplete();h.expand(e,{onComplete:function(){b.onExpandComplete();b.onAfterCompute(c);b.onComplete();j.busy=false}})}})}})}})}}};var Trans={linear:function(a){return a},Quart:function(a){return Math.pow(a,4)},easeIn:function(a,b){return a(b)},easeOut:function(a,b){return 1-a(1-b)},easeInOut:function(a,b){return(b<=0.5)?a(2*b)/2:(2-a(2*(1-b)))/2}};var Animation={duration:Config.animationTime,fps:Config.fps,transition:function(a){return Trans.easeInOut(Trans.Quart,a)},controller:false,getTime:function(){var a=(Date.now)?Date.now():new Date().getTime();return a},step:function(){var a=this.getTime();if(a<this.time+this.duration){var b=this.transition((a-this.time)/this.duration);this.controller.compute(b)}else{this.timer=clearInterval(this.timer);this.controller.compute(1);this.controller.complete()}},start:function(){this.time=0;this.startTimer();return this},startTimer:function(){if(this.timer){return false}this.time=this.getTime()-this.time;this.timer=setInterval((function(){Animation.step()}),Math.round(1000/this.fps));return true}};